<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Men√∫ Digital | APECAFEQ Quinch√≠a</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
:root{
  --cafe-oscuro:#2c1810;--cafe-medio:#6f4e37;--cafe-claro:#a67b5b;--crema:#f3e5ab;--papel:#faf7f2;--dorado:#d4af37;--verde-wa:#25D366;--rojo-alerta:#e74c3c;--verde-suave:#4CAF50;--sombra-suave:0 4px 15px rgba(44,24,16,0.08);--sombra-fuerte:0 8px 30px rgba(44,24,16,0.2);--radio-borde:16px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:'Lato',sans-serif;background-color:var(--papel);color:var(--cafe-oscuro);background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%236f4e37' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");padding-bottom:100px}
header{position:relative;background:linear-gradient(rgba(44,24,16,0.85),rgba(44,24,16,0.7)), url('https://images.unsplash.com/photo-1509042239860-f550ce710b93?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');background-size:cover;background-position:center;color:white;text-align:center;padding:4rem 1.5rem 3rem;border-bottom-left-radius:40px;border-bottom-right-radius:40px;box-shadow:var(--sombra-fuerte);overflow:hidden}
.logo-circle{width:100px;height:100px;background:white;border-radius:50%;margin:0 auto 15px;display:flex;align-items:center;justify-content:center;border:3px solid var(--dorado);color:var(--cafe-oscuro);font-size:2.5rem}
h1{font-family:'Playfair Display',serif;font-size:2.8rem;margin-bottom:5px;letter-spacing:2px;text-transform:uppercase;text-shadow:2px 2px 4px rgba(0,0,0,0.5)}
.subtitle{font-size:1.1rem;font-weight:300;letter-spacing:1px;text-transform:uppercase;color:var(--crema);margin-bottom:1rem}
.slogan{font-family:'Playfair Display',serif;font-style:italic;font-size:1rem;max-width:600px;margin:0 auto;opacity:0.9;background:rgba(255,255,255,0.15);padding:10px 20px;border-radius:20px;backdrop-filter:blur(5px)}
.nav-sticky-wrapper{position:sticky;top:0;z-index:100;background:rgba(250,247,242,0.95);backdrop-filter:blur(10px);box-shadow:0 2px 10px rgba(0,0,0,0.05);padding:10px 0}
.category-nav{display:flex;overflow-x:auto;gap:12px;padding:5px 20px;scrollbar-width:none}
.category-nav::-webkit-scrollbar{display:none}
.cat-btn{background:transparent;border:1px solid var(--cafe-medio);color:var(--cafe-medio);padding:8px 18px;border-radius:25px;white-space:nowrap;font-family:'Playfair Display',serif;font-weight:700;cursor:pointer;transition:all 0.3s ease;font-size:0.95rem}
.cat-btn.active{background:var(--cafe-oscuro);color:var(--dorado);border-color:var(--cafe-oscuro);box-shadow:0 4px 10px rgba(44,24,16,0.3);transform:scale(1.05)}
.menu-wrapper{max-width:1000px;margin:0 auto;padding:20px}
.section-header{display:flex;align-items:center;margin:2.5rem 0 1.5rem;color:var(--cafe-oscuro)}
.section-header h2{font-family:'Playfair Display',serif;font-size:1.8rem;margin-right:15px;white-space:nowrap}
.section-line{height:2px;background:var(--cafe-claro);flex-grow:1;opacity:0.3;border-radius:2px}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}
.product-card{background:white;border-radius:var(--radio-borde);padding:18px;display:flex;justify-content:space-between;align-items:center;box-shadow:var(--sombra-suave);transition:transform 0.2s,box-shadow 0.2s;border:1px solid rgba(0,0,0,0.03);position:relative;overflow:hidden}
.product-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:5px;background:var(--cafe-claro)}
.product-card:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(0,0,0,0.08)}
.product-info h3{font-size:1.05rem;font-weight:700;color:var(--cafe-oscuro);margin-bottom:5px}
.product-desc{font-size:0.8rem;color:#777;font-style:italic}
.product-price{font-weight:700;color:var(--cafe-medio);font-size:1.1rem;margin-top:5px}
.add-btn{width:40px;height:40px;border-radius:50%;border:none;background:var(--papel);color:var(--cafe-oscuro);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;border:1px solid var(--cafe-claro)}
.add-btn:active{background:var(--cafe-oscuro);color:white;transform:scale(0.9)}
.fab-container{position:fixed;bottom:25px;right:25px;z-index:900;animation:bounceIn 1s}
@keyframes bounceIn{0%{transform:scale(0);opacity:0}60%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}
.fab{background:var(--cafe-oscuro);color:var(--dorado);padding:15px 25px;border-radius:50px;box-shadow:0 10px 25px rgba(44,24,16,0.4);display:flex;align-items:center;gap:12px;cursor:pointer;transition:transform 0.2s}
.fab:hover{transform:scale(1.05)}
.fab-badge{background:var(--rojo-alerta);color:white;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:bold;position:absolute;top:-5px;right:-5px;box-shadow:0 2px 5px rgba(0,0,0,0.2)}
.modal-backdrop{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);z-index:1000;justify-content:center;align-items:flex-end}
.cart-modal-content{background:white;width:100%;max-width:500px;height:85vh;border-radius:25px 25px 0 0;display:flex;flex-direction:column;animation:slideUp 0.3s ease-out;box-shadow:0 -10px 40px rgba(0,0,0,0.2)}
.success-modal-content{background:var(--papel);width:90%;max-width:400px;padding:30px;border-radius:var(--radio-borde);text-align:center;box-shadow:var(--sombra-fuerte);animation:fadeInScale 0.4s ease-out;border:3px solid var(--dorado)}
@keyframes fadeInScale{0%{transform:scale(0.8);opacity:0}100%{transform:scale(1);opacity:1}}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal-header{padding:20px 25px;border-bottom:1px dashed var(--cafe-claro);display:flex;justify-content:space-between;align-items:center}
.modal-title{font-family:'Playfair Display',serif;font-size:1.5rem;color:var(--cafe-oscuro)}
.close-modal{background:none;border:none;font-size:1.8rem;color:#999;cursor:pointer}
.cart-items-container{flex-grow:1;overflow-y:auto;padding:20px}
.empty-cart-msg{text-align:center;color:#999;margin-top:50px;display:flex;flex-direction:column;align-items:center;gap:15px}
.cart-item{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid #eee}
.cart-item-info strong{display:block;color:var(--cafe-oscuro);margin-bottom:4px}
.cart-item-info small{color:var(--cafe-medio)}
.qty-selector{display:flex;align-items:center;gap:10px;background:#f5f5f5;padding:5px;border-radius:30px}
.qty-btn{width:28px;height:28px;border-radius:50%;border:none;background:white;color:var(--cafe-oscuro);font-weight:bold;cursor:pointer;box-shadow:0 2px 5px rgba(0,0,0,0.05)}
.modal-footer{padding:25px;background:#fcfcfc;border-top:1px solid #eee}
.total-row{display:flex;justify-content:space-between;align-items:center;font-size:1.4rem;font-weight:700;color:var(--cafe-oscuro);margin-bottom:20px;font-family:'Playfair Display',serif}
.table-input{width:100%;padding:12px;border:2px solid var(--cafe-claro);border-radius:12px;margin-bottom:15px;font-family:'Lato',sans-serif;font-size:1rem;font-weight:700;text-align:center;transition:border 0.3s,box-shadow 0.3s}
.table-input:focus{border-color:var(--dorado);box-shadow:0 0 0 3px rgba(212,175,55,0.3);outline:none}
.notes-input{width:100%;padding:12px;border:1px solid #ddd;border-radius:12px;margin-bottom:15px;font-family:'Lato',sans-serif;resize:none;transition:border 0.3s}
.notes-input:focus{border-color:var(--cafe-medio);outline:none}
.validation-message{display:none;background:var(--rojo-alerta);color:white;padding:10px;border-radius:8px;text-align:center;margin-bottom:15px;font-weight:700;transition:opacity 0.5s ease-out;opacity:0}
.whatsapp-btn{width:100%;background:var(--verde-wa);color:white;border:none;padding:16px;border-radius:12px;font-size:1.1rem;font-weight:700;display:flex;align-items:center;justify-content:center;gap:10px;cursor:pointer;box-shadow:0 4px 15px rgba(37,211,102,0.3);transition:transform 0.2s}
.whatsapp-btn:hover{transform:translateY(-2px)}
.flavor-select{margin-top:10px;padding:8px;border-radius:10px;border:1px solid #ddd;font-weight:700}
@media(min-width:768px){.modal-backdrop{align-items:center}.cart-modal-content{height:auto;max-height:80vh;border-radius:20px}}
</style>
</head>
<body>

<header>
  <div class="header-content">
    <div class="logo-circle">
      <img src="https://static.wixstatic.com/media/442082_eba13a550b2944328257a48cc8e23f90~mv2.png" alt="APECAFEQ logo" style="width:84px;height:84px;object-fit:cover;border-radius:50%;">
    </div>
    <h1>APECAFEQ</h1>
    <p class="subtitle">Quinch√≠a - Risaralda</p>
    <div class="slogan"><i class="fas fa-coffee"></i> "¬°Orgullosamente Cafeteros por Tradici√≥n! Caf√© de alta calidad con notas entre c√≠tricas y dulces."</div>
  </div>
</header>

<div class="nav-sticky-wrapper">
  <nav class="category-nav" id="categoryNav"></nav>
</div>

<main class="menu-wrapper" id="menuWrapper"></main>

<!-- FAB -->
<div class="fab-container" onclick="toggleCart()">
  <div class="fab">
    <i class="fas fa-shopping-basket fab-icon"></i>
    <span class="fab-text">Mi Pedido</span>
    <div class="fab-badge" id="cartCount">0</div>
  </div>
</div>

<!-- Carrito Modal -->
<div class="modal-backdrop" id="cartModal">
  <div class="cart-modal-content">
    <div class="modal-header">
      <h2 class="modal-title">Tu Comanda</h2>
      <button class="close-modal" onclick="toggleCart()">&times;</button>
    </div>

    <div class="cart-items-container" id="cartItems"></div>

    <div class="modal-footer">
      <input type="number" class="table-input" id="tableNumber" placeholder="* N√∫mero de Mesa (Obligatorio)" required min="1">
      <div id="validationMessage" class="validation-message"></div>
      <textarea class="notes-input" id="orderNotes" rows="2" placeholder="üìù Notas (Ej: sin az√∫car, leche deslactosada...)"></textarea>
      <div class="total-row"><span>Total:</span><span id="cartTotal">$0</span></div>
      <button class="whatsapp-btn" onclick="sendOrder()"><i class="fab fa-whatsapp" style="font-size:1.4rem"></i> Enviar Comanda</button>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="modal-backdrop" id="successModal" style="align-items:center;">
  <div class="success-modal-content">
    <h3><i class="fas fa-hand-sparkles"></i> ¬°Orden Recibida!</h3>
    <p id="fortuneMessage"></p>
    <button onclick="document.getElementById('successModal').style.display='none'">Genial, Gracias</button>
  </div>
</div>

<script>
/* ---------------------------
   MENU DATA (actualizados)
   --------------------------- */
const menuData = [
  {
    id: 'calientes',
    name: 'Bebidas Calientes',
    items: [
      {name:'Caf√© Xixaraca', price:3500},
      {name:'Caf√© Campesino', price:3800},
      {name:'Caf√© Espresso', price:3500},
      {name:'Espresso Doble', price:4000},
      {name:'Capuccino', price:4500},
      {name:'Capuccino Especial', price:5000},
      {name:'Mocaccino', price:5000},
      {name:'Chocolate', price:4500},
      {name:'Bomb√≥n', price:4000},
      {name:'Chocomelos', price:6000},
      {name:'Aguapanela', price:3800},
      {name:'Milo Caliente', price:5000},
      {name:'Caspiroleta', price:5000},
      {name:'Maizenita', price:5000},
      {name:'Maizenita Caf√©', price:5000},
      {name:'Macana', price:5500},
      {name:'Caf√© Tiramis√∫', price:10500},
      {name:'Vaso de Leche', price:4000}
    ]
  },
  {
    id: 'aromaticas',
    name: 'Arom√°ticas',
    items: [
      {name:'Arom√°tica Tradicional', price:2000},
      {name:'Arom√°tica Artesanal', price:6000},
      {name:'Arom√°tica de Frutas', price:3500},
      {name:'Frutos Deshidratados', price:7000},
      {name:'T√© Chai', price:6000} // precio actualizado
    ]
  },
  {
    id: 'frias',
    name: 'Bebidas Fr√≠as',
    items: [
      {name:'Malteada', price:10500, flavors:['Caf√©','Frutos Rojos','Vainilla','Brownie','Maracuy√°','Tiramis√∫']},
      {name:'Helado y Caf√©', price:10000},
      {name:'Frappe', price:5000},
      {name:'Granizado de Caf√©', price:5000},
      {name:'Granizado de Frutas', price:7500},
      {name:'Mocca Helado', price:7300},
      {name:'Helado Espresso', price:6500},
      {name:'Xixaraca Fr√≠o', price:4000},
      {name:'Limonada de Caf√©', price:4500},
      {name:'Soda de Caf√©', price:8300},
      {name:'Soda Michelada', price:6500},
      {name:'Soda Saborizada', price:9000},
      {name:'Soda Simple', price:3500},
      {name:'Tamarindo', price:3800},
      {name:'Tamarindo Michelado', price:5500},
      {name:'Milo Fr√≠o', price:5500},
      {name:'Helado MiniChips', price:7300}, // renombrado
      {name:'Cold Brew', price:5000},
      {name:'T√© Chai Fr√≠o', price:7000},
      {name:'Jugo en agua', price:4000},
      {name:'Jugo en leche', price:5200},
      {name:'Botella con agua', price:1000}
    ]
  },
  {
    id: 'licor',
    name: 'Bebidas con Licor',
    items: [
      {name:'Capuccino con Licor', price:8000},
      {name:'Caf√© Irland√©s', price:9000},
      {name:'Caf√© y Licor', price:7000},
      {name:'Granizado con Licor', price:8000},
      {name:'Soda Italiana', price:10000},
      {name:'Caf√© Imperial', price:13000}, // precio actualizado
      {name:'Affogato', price:11000},
      {name:'Copa de Vino', price:6000},
      {name:'Botella de Vino', price:36000},
      {name:'Vino Caliente', price:10000}, // a√±adido
      {name:'Adicional de Licor', price:7000}
    ]
  },
  {
    id: 'acompa',
    name: 'Acompa√±a tu Caf√©',
    items: [
      {name:'Torta de la Casa', price:3500},
      {name:'Torta con Helado', price:6000},
      {name:'Almohabana', price:2300},
      {name:'Pastel Hojaldrado', price:4500},
      {name:'Dedo de Queso', price:1700},
      {name:'Arepa de Queso', price:1200},
      {name:'Brownie con Helado', price:9500},
      {name:'Helado de mi Tierra', price:14600},
      {name:'Torta Griega', price:8500},
      {name:'Sandwich', price:7500}
    ]
  },
  {
    id: 'cocteles',
    name: 'C√≥cteles',
    items: [
      {name:'Margarita', price:14000},
      {name:'Mojito', price:12000}
    ]
  }
];

/* ---------------------------
   Fortuna messages y configuraci√≥n
   --------------------------- */
const QUINCHIA_FORTUNES = [
  "La mejor vista del Eje Cafetero es la que tienes ahora, esperando tu caf√©.",
  "Recuerda que la felicidad se mide en el n√∫mero de tazas de caf√© al d√≠a. ¬°Hoy vas bien!",
  "Un buen grano de Risaralda sabe que el secreto est√° en la paciencia. Tu pedido ya est√° en camino.",
  "Hoy es un d√≠a perfecto para una pausa. Tu elecci√≥n de caf√© ha sido sabia.",
  "El aroma que persigues te llevar√° a grandes ideas. ¬°Disfruta tu Quixaraca!",
  "No te preocupes por el ma√±ana, el caf√© de hoy es suficiente bendici√≥n.",
  "Tu alma est√° tan llena como la taza que pronto tendr√°s en tus manos. ¬°Salud!",
  "La vida es corta, pero una buena taza de caf√© colombiano la hace sentir eterna.",
  "Como el grano en la monta√±a, superar√°s todos los retos con altura y buen sabor."
];

let cart = {};
const WHATSAPP_NUMBER = "573132293165";

/* ---------------------------
   UTIL: formateador de moneda
   --------------------------- */
function formatMoney(n){
  return n.toLocaleString('es-CO');
}

/* ---------------------------
   RENDER: genera el DOM del men√∫
   --------------------------- */
function init(){
  const nav = document.getElementById('categoryNav');
  const main = document.getElementById('menuWrapper');
  nav.innerHTML = '';
  main.innerHTML = '';

  menuData.forEach((section, sIndex) => {
    // bot√≥n nav
    const btn = document.createElement('button');
    btn.className = `cat-btn ${sIndex===0?'active':''}`;
    btn.innerText = section.name;
    btn.onclick = () => scrollToSection(section.id, btn);
    nav.appendChild(btn);

    // secci√≥n
    const secDiv = document.createElement('div');
    secDiv.id = section.id;
    secDiv.innerHTML = `
      <div class="section-header">
        <h2>${section.name}</h2>
        <div class="section-line"></div>
      </div>
      <div class="products-grid" id="grid-${section.id}"></div>
    `;
    main.appendChild(secDiv);

    // tarjetas
    const grid = secDiv.querySelector(`#grid-${section.id}`);
    section.items.forEach((item, idx) => {
      // id seguro para selects
      const safeId = `${section.id}-${idx}`;
      const priceStr = `$${formatMoney(item.price)}`;
      let flavorHTML = '';
      if(Array.isArray(item.flavors) && item.flavors.length){
        flavorHTML = `<select class="flavor-select" id="flavor-${safeId}" data-selected=""><option value="" disabled selected>Elige sabor</option>${item.flavors.map(f=>`<option value="${f}">${f}</option>`).join('')}</select>`;
      }
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <div class="product-info">
          <h3>${item.name}</h3>
          <div class="product-price">${priceStr}</div>
          ${flavorHTML}
        </div>
        <button class="add-btn" data-section="${section.id}" data-idx="${idx}"><i class="fas fa-plus"></i></button>
      `;
      // a√±adir listener al bot√≥n (mejor que onclick inline para manejar safeId)
      const addBtn = card.querySelector('.add-btn');
      addBtn.addEventListener('click', () => addToCartByIndex(section.id, idx));
      grid.appendChild(card);
    });
  });

  // observar secciones para nav activo
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        const id = entry.target.id;
        const sectionName = menuData.find(m=>m.id===id)?.name;
        if(sectionName){
          document.querySelectorAll('.cat-btn').forEach(b => b.classList.toggle('active', b.innerText === sectionName));
          const activeBtn = document.querySelector('.cat-btn.active');
          if(activeBtn) activeBtn.scrollIntoView({behavior:'smooth',block:'nearest',inline:'center'});
        }
      }
    });
  }, {threshold:0.5});
  // usar peque√±o timeout para asegurar que se renderiz√≥
  setTimeout(() => {
    menuData.forEach(section => {
      const el = document.getElementById(section.id);
      if(el) observer.observe(el);
    });
  }, 300);
}

/* ---------------------------
   SCROLL a secci√≥n
   --------------------------- */
function scrollToSection(id, btn){
  const el = document.getElementById(id);
  if(el) el.scrollIntoView({behavior:'smooth',block:'start'});
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

/* ---------------------------
   MODAL carrito
   --------------------------- */
function toggleCart(){
  const modal = document.getElementById('cartModal');
  const isVisible = modal.style.display === 'flex';
  modal.style.display = isVisible ? 'none' : 'flex';
  if(!isVisible) renderCart();
}
// cerrar modal al click fuera
document.getElementById('cartModal').addEventListener('click', function(e){
  if(e.target === this) toggleCart();
});

/* ---------------------------
   A√±adir al carrito por √≠ndice seguro
   --------------------------- */
function addToCartByIndex(sectionId, idx){
  const section = menuData.find(s => s.id === sectionId);
  if(!section) return;
  const item = section.items[idx];
  if(!item) return;

  const safeId = `${sectionId}-${idx}`;
  // si tiene sabores, validar selecci√≥n
  if(Array.isArray(item.flavors) && item.flavors.length){
    const select = document.getElementById(`flavor-${safeId}`);
    const val = select?.value || '';
    if(!val){
      // mostrar validaci√≥n (breve)
      showTemporaryMessage('Selecciona un sabor para la Malteada primero.', document.getElementById('validationMessage'));
      return;
    }
    const nameWithFlavor = `${item.name} (${val})`;
    addToCartInternal(nameWithFlavor, item.price);
  } else {
    addToCartInternal(item.name, item.price);
  }
}

/* funci√≥n interna para el carrito */
function addToCartInternal(name, price){
  if(!cart[name]) cart[name] = {price: price, qty: 1};
  else cart[name].qty += 1;
  updateCartBadge();
  // mini feedback
  const fab = document.querySelector('.fab');
  fab.style.transform = 'scale(1.15)';
  setTimeout(() => fab.style.transform = 'scale(1)', 180);
}

/* ---------------------------
   Cambiar qty y render carrito
   --------------------------- */
function changeQty(name, delta){
  if(cart[name]){
    cart[name].qty += delta;
    if(cart[name].qty <= 0) delete cart[name];
    renderCart();
    updateCartBadge();
  }
}

function updateCartBadge(){
  let count = 0;
  Object.values(cart).forEach(i => count += i.qty);
  document.getElementById('cartCount').innerText = count;
}

function renderCart(){
  const container = document.getElementById('cartItems');
  const totalEl = document.getElementById('cartTotal');
  container.innerHTML = '';
  let total = 0;
  const entries = Object.entries(cart);
  if(entries.length === 0){
    container.innerHTML = `
      <div class="empty-cart-msg">
        <i class="fas fa-mug-hot" style="font-size:3rem;color:#ddd"></i>
        <p>No hay productos en la comanda.</p>
        <button onclick="toggleCart()" style="color:var(--cafe-medio);border:none;background:none;text-decoration:underline;cursor:pointer;">Volver al men√∫</button>
      </div>
    `;
    totalEl.innerText = `$0`;
    return;
  }

  entries.forEach(([name, item]) => {
    const subtotal = item.price * item.qty;
    total += subtotal;
    const row = document.createElement('div');
    row.className = 'cart-item';
    row.innerHTML = `
      <div class="cart-item-info">
        <strong>${name}</strong>
        <small>$${formatMoney(item.price)} c/u</small>
      </div>
      <div class="qty-selector">
        <button class="qty-btn" data-name="${name}" data-delta="-1">-</button>
        <span style="font-weight:bold; min-width:20px; text-align:center;">${item.qty}</span>
        <button class="qty-btn" data-name="${name}" data-delta="1">+</button>
      </div>
    `;
    container.appendChild(row);
  });

  // listeners para botones qty creados
  container.querySelectorAll('.qty-btn').forEach(b => {
    b.addEventListener('click', () => {
      const name = b.getAttribute('data-name');
      const delta = parseInt(b.getAttribute('data-delta'), 10);
      changeQty(name, delta);
    });
  });

  totalEl.innerText = `$${formatMoney(total)}`;
}

/* ---------------------------
   Mensajes de validaci√≥n temporales
   --------------------------- */
function showTemporaryMessage(msg, element){
  element.innerText = msg;
  element.style.display = 'block';
  void element.offsetWidth;
  element.style.opacity = '1';
  setTimeout(() => {
    element.style.opacity = '0';
    setTimeout(() => { element.style.display = 'none'; }, 400);
  }, 2500);
}

/* ---------------------------
   Fortuna
   --------------------------- */
function showSuccessMessage(){
  const rand = Math.floor(Math.random() * QUINCHIA_FORTUNES.length);
  document.getElementById('fortuneMessage').innerText = QUINCHIA_FORTUNES[rand];
  document.getElementById('successModal').style.display = 'flex';
}

/* ---------------------------
   Env√≠o a WhatsApp
   --------------------------- */
function sendOrder(){
  const tableNumberInput = document.getElementById('tableNumber');
  const tableNumber = (tableNumberInput.value || '').toString().trim();
  const notes = document.getElementById('orderNotes').value || '';
  const validationMessage = document.getElementById('validationMessage');

  if(Object.keys(cart).length === 0){
    showTemporaryMessage('Por favor, agrega productos a tu comanda primero ‚òï', validationMessage);
    return;
  }
  if(!tableNumber || isNaN(tableNumber) || parseInt(tableNumber,10) <= 0){
    showTemporaryMessage('üõë El n√∫mero de Mesa es *obligatorio*. Por favor, ingr√©salo.', validationMessage);
    tableNumberInput.focus();
    return;
  }

  let message = `üëã *MESA No. ${tableNumber}* - Nueva Comanda:\n\n`;
  let total = 0;
  Object.entries(cart).forEach(([name, item]) => {
    const subtotal = item.price * item.qty;
    total += subtotal;
    message += `‚ñ™ *${item.qty}x* ${name} ($${formatMoney(subtotal)})\n`;
  });
  message += `\nüí∞ *TOTAL: $${formatMoney(total)}*`;
  if(notes.trim()) message += `\n\nüìù *Notas Adicionales:* ${notes}`;

  const encodedMsg = encodeURIComponent(message);
  window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMsg}`, '_blank');

  // cerrar y mostrar fortuna
  toggleCart();
  showSuccessMessage();

  // limpiar carrito y campos
  cart = {};
  document.getElementById('tableNumber').value = '';
  document.getElementById('orderNotes').value = '';
  updateCartBadge();
}

/* ---------------------------
   Inicializar app
   --------------------------- */
init();
</script>

</body>
</html>
